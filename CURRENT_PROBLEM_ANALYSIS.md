# í˜„ì¬ STT ë¬¸ì œ - ì™„ì „ ë¶„ì„

## í˜„ì¬ ìƒí™©

**ì‚¬ìš©ì ë³´ê³ **: ì²« ë²ˆì§¸ ë°œí™”ë§Œ ì¸ì‹ë˜ê³ , ë‘ ë²ˆì§¸ë¶€í„° ì¸ì‹ ì•ˆë¨

## ì‹¤ì œ ì‘ë™ ë°©ì‹ (ë¡œê·¸ ê¸°ë°˜ ë¶„ì„)

### íƒ€ì„ë¼ì¸

```
09:39:07 - ğŸ¬ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ (ì²« ë²ˆì§¸)
09:39:08 - ğŸ“¤ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
09:39:14 - âœ… API ì—°ê²° ì„±ê³µ
09:39:14 - ğŸ”„ Final result ë°›ìŒ - ìŠ¤íŠ¸ë¦¼ ì¬ì‹œì‘ì„ ìœ„í•´ ì¢…ë£Œ
09:39:14 - ğŸ¤ [ë°œí™” ì™„ë£Œ #1] ëˆ„êµ¬ì„¸ìš”?  â† âœ… ì²« ë²ˆì§¸ ì¸ì‹ ì„±ê³µ

--- LLM + TTS ì²˜ë¦¬ (ì•½ 5ì´ˆ) ---

09:39:19 - ğŸ”„ [STTSession] ìŠ¤íŠ¸ë¦¼ ìë™ ì¬ì‹œì‘ #1  â† ì¬ì‹œì‘ ì‹œì‘
09:39:19 - ğŸ™ï¸ [StreamingSTT] ì´ˆê¸°í™” ì™„ë£Œ (ìƒˆ ë§¤ë‹ˆì € ìƒì„±)
09:39:19 - ğŸ¬ [StreamingSTT] ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘ (ë‘ ë²ˆì§¸)
09:39:20 - ğŸ“¤ [StreamingSTT] ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ì‹œì‘
09:39:30 - âœ… [StreamingSTT Thread] API ì—°ê²° ì„±ê³µ  â† 11ì´ˆ ê±¸ë¦¼!

... ì´í›„ ì•„ë¬´ ì¸ì‹ ì—†ìŒ ...

09:39:43 - ğŸ›‘ ì„¸ì…˜ ì¢…ë£Œ - ìµœì¢…: 0ê°œ  â† âŒ ë‘ ë²ˆì§¸ ë°œí™” ì¸ì‹ ì‹¤íŒ¨
```

## ê·¼ë³¸ ì›ì¸

### ë¬¸ì œ 1: Google Cloud ì¬ì—°ê²° ì‹œê°„ì´ ë„ˆë¬´ ê¹€ (11ì´ˆ)

```python
# process_results() - Line 421
self.manager = StreamingSTTManager(self.call_sid)  # ìƒˆ ë§¤ë‹ˆì € ìƒì„±
```

**ìƒˆ ë§¤ë‹ˆì € ìƒì„± ì‹œ:**
1. `_init_google_client()` - Google Cloud ì¸ì¦ (~1-2ì´ˆ)
2. `speech.SpeechClient()` - í´ë¼ì´ì–¸íŠ¸ ìƒì„± (~1-2ì´ˆ)
3. `start_streaming()` - ìŠ¤íŠ¸ë¦¼ ì‹œì‘ (~1-2ì´ˆ)
4. `streaming_recognize()` - API í˜¸ì¶œ (~6-8ì´ˆ) â† **ê°€ì¥ ì˜¤ë˜ ê±¸ë¦¼**

**ì´ 11ì´ˆ** ì†Œìš”

### ë¬¸ì œ 2: ì˜¤ë””ì˜¤ í ì†ì‹¤

```python
# StreamingSTTManager.__init__ - Line 41
self.audio_queue: asyncio.Queue = asyncio.Queue()  # ìƒˆ í ìƒì„±!
```

**ì¬ì‹œì‘ ì‹œ:**
1. ê¸°ì¡´ ë§¤ë‹ˆì € ë²„ë¦¼ â†’ **ê¸°ì¡´ íì˜ ì˜¤ë””ì˜¤ ëª¨ë‘ ì‚¬ë¼ì§**
2. ìƒˆ ë§¤ë‹ˆì € ìƒì„± â†’ ë¹ˆ íë¡œ ì‹œì‘
3. WebSocketì—ì„œ ê³„ì† ì˜¤ë””ì˜¤ ë“¤ì–´ì˜´ â†’ ìƒˆ íì— ìŒ“ì„
4. í•˜ì§€ë§Œ Google Cloud ì—°ê²° ì•ˆë¨ (11ì´ˆ ëŒ€ê¸° ì¤‘)
5. **ì‚¬ìš©ìëŠ” 2-3ì´ˆ ì•ˆì— ë§ ëëƒ„**
6. Google Cloud ì—°ê²° ì™„ë£Œí–ˆì„ ë•ŒëŠ” ì´ë¯¸ ëŠ¦ìŒ

### ë¬¸ì œ 3: ì¬ì—°ê²° ì¤‘ ì˜¤ë””ì˜¤ ì²˜ë¦¬

**ì‚¬ìš©ì ë°œí™” íƒ€ì´ë°:**
```
09:39:19 - ì¬ì‹œì‘ ì‹œì‘
09:39:20 - ì‚¬ìš©ì: "ì•ˆë…•í•˜ì„¸ìš” ì €ëŠ”..." (ë§í•˜ê¸° ì‹œì‘)
09:39:22 - ì‚¬ìš©ì: ë§ ëë‚¨ (ì´ 2-3ì´ˆ)
09:39:30 - Google Cloud ì—°ê²° ì™„ë£Œ (11ì´ˆ í›„)
```

**Google Cloud ì…ì¥:**
- 09:39:30ì— ì—°ê²° ì™„ë£Œ
- íì— 09:39:20~09:39:30 ì˜¤ë””ì˜¤ê°€ ìˆìŒ
- í•˜ì§€ë§Œ ì‚¬ìš©ìëŠ” ì´ë¯¸ ì¹¨ë¬µ
- Google Cloud: "ì¹¨ë¬µì´ë„¤? ì•„ë¬´ê²ƒë„ ì•ˆí•˜ê³  ëŒ€ê¸°..."
- **ì¸ì‹ ê²°ê³¼ ì—†ìŒ**

## ì™œ ì´ë ‡ê²Œ ì„¤ê³„ë˜ì—ˆë‚˜?

### ì›ë˜ ì˜ë„
```python
# ê° final result í›„ ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ â†’ ì¬ì‹œì‘
if is_final:
    break  # ìŠ¤íŠ¸ë¦¼ ì¢…ë£Œ
```

**ì˜ë„:**
- Google Cloudê°€ `single_utterance=False`ì—¬ë„ ìŠ¤íŠ¸ë¦¼ì„ ë©ˆì¶”ëŠ” ë²„ê·¸ ìš°íšŒ
- ë§¤ ë°œí™”ë§ˆë‹¤ ê°•ì œë¡œ ì¬ì‹œì‘

**ë¬¸ì œ:**
- ì¬ì—°ê²° ì‹œê°„(11ì´ˆ)ì„ ê³ ë ¤í•˜ì§€ ì•ŠìŒ
- ì‹¤ì‹œê°„ ëŒ€í™”ì—ëŠ” ë¶€ì í•©

## í˜„ì¬ ì•„í‚¤í…ì²˜ì˜ í•œê³„

```
StreamingSTTSession
  â†“
  self.manager (StreamingSTTManager)
    â†“
    self.audio_queue (asyncio.Queue)  â† ë§¤ë‹ˆì €ë§ˆë‹¤ ìƒˆ í!
```

**ì¬ì‹œì‘ ì‹œ:**
```
StreamingSTTSession
  â†“
  self.manager = NEW StreamingSTTManager  â† ìƒˆ ê°ì²´
    â†“
    self.audio_queue = NEW Queue  â† ìƒˆ í (ê¸°ì¡´ ì˜¤ë””ì˜¤ ì†ì‹¤!)
```

## í•„ìš”í•œ í•´ê²°ì±…

### ì˜µì…˜ 1: íë¥¼ Session ë ˆë²¨ë¡œ ì´ë™ (ê¶Œì¥)

```python
class StreamingSTTSession:
    def __init__(self):
        self.audio_queue = asyncio.Queue()  # Sessionì´ ì†Œìœ 
        self.manager = None

    async def add_audio(self, audio_data):
        await self.audio_queue.put(audio_data)  # Session íì— ì¶”ê°€

    async def process_results(self):
        while self.is_running:
            # ManagerëŠ” Sessionì˜ íë¥¼ ì‚¬ìš©
            self.manager = StreamingSTTManager(self.call_sid, self.audio_queue)
            async for result in self.manager.start_streaming():
                yield result
            # ì¬ì‹œì‘ ì‹œì—ë„ ê°™ì€ í ì‚¬ìš©!
```

**ì¥ì :**
- ì˜¤ë””ì˜¤ ì†ì‹¤ ì—†ìŒ
- ì¬ì—°ê²° ì¤‘ì—ë„ ì˜¤ë””ì˜¤ê°€ íì— ê³„ì† ìŒ“ì„

### ì˜µì…˜ 2: Client ì¬ì‚¬ìš©

```python
class StreamingSTTSession:
    def __init__(self):
        self.client = speech.SpeechClient()  # í•œ ë²ˆë§Œ ìƒì„±

    async def process_results(self):
        while self.is_running:
            # ClientëŠ” ì¬ì‚¬ìš©, ìŠ¤íŠ¸ë¦¼ë§Œ ì¬ì‹œì‘
            async for result in self._start_stream(self.client):
                yield result
```

**ì¥ì :**
- ì¬ì—°ê²° ì‹œê°„ ë‹¨ì¶• (11ì´ˆ â†’ 2-3ì´ˆ)

### ì˜µì…˜ 3: ìŠ¤íŠ¸ë¦¼ì„ ëŠì§€ ì•ŠìŒ (ê·¼ë³¸ì  í•´ê²°)

```python
# Final result í›„ì—ë„ breakí•˜ì§€ ì•ŠìŒ
for response in responses:
    result_queue.put(result_dict)
    # if is_final: break  â† ì´ê±° ì œê±°!
```

**ì¥ì :**
- ì¬ì—°ê²° ì—†ìŒ
- ì§€ì—° ì—†ìŒ

**ë‹¨ì :**
- Google Cloudê°€ ìŠ¤íŠ¸ë¦¼ì„ ë©ˆì¶”ëŠ” ë²„ê·¸ê°€ ìˆìŒ
- í•˜ì§€ë§Œ ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•´ë´ì•¼ í•¨

## ì¶”ì²œ í•´ê²° ë°©ë²•

### ì¦‰ì‹œ í…ŒìŠ¤íŠ¸: Final break ì œê±°

**ê°€ì„¤:** Google Cloudê°€ ì •ë§ë¡œ ìŠ¤íŠ¸ë¦¼ì„ ë©ˆì¶”ëŠ”ì§€ í™•ì¸

**ë³€ê²½:**
```python
# streaming_stt_manager.py Line 272-274
# ì£¼ì„ ì²˜ë¦¬:
# if is_final:
#     logger.info("ğŸ”„ Final result ë°›ìŒ - ìŠ¤íŠ¸ë¦¼ ì¬ì‹œì‘ì„ ìœ„í•´ ì¢…ë£Œ")
#     break
```

**í…ŒìŠ¤íŠ¸:**
1. ì—°ì†ìœ¼ë¡œ 5-10íšŒ ë§í•˜ê¸°
2. ëª¨ë‘ ì¸ì‹ë˜ëŠ”ì§€ í™•ì¸
3. ë¡œê·¸ì—ì„œ ìŠ¤íŠ¸ë¦¼ì´ ì–¸ì œ ëŠê¸°ëŠ”ì§€ í™•ì¸

**ë§Œì•½ ì‘ë™í•œë‹¤ë©´:**
- ë¬¸ì œ í•´ê²°! (ê°€ì¥ ê°„ë‹¨)
- ì¬ì—°ê²° ì—†ìŒ = ì§€ì—° ì—†ìŒ

**ë§Œì•½ ì²« ë°œí™” í›„ ë©ˆì¶˜ë‹¤ë©´:**
- ì˜µì…˜ 1 ë˜ëŠ” 2 êµ¬í˜„ í•„ìš”

## ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ:** Final break ì œê±°í•˜ê³  í…ŒìŠ¤íŠ¸
2. **ì•ˆë˜ë©´:** Session ë ˆë²¨ íë¡œ ë¦¬íŒ©í† ë§
3. **ìµœì¢…:** Client ì¬ì‚¬ìš© ìµœì í™”
