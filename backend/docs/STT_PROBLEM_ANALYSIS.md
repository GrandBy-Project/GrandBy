# STT 인식 문제 분석

## 🚨 발견된 문제

### 1. 이상한 단어들만 인식됨
```
발화: "안녕 오늘 일기 작성하려고 해"
인식: "안녕 오늘 일 짓으려고" ⚠️
```
- "일기"가 "일"로 잘림
- 완전한 문장이 아니라 조각만 인식

```
발화: "아니 일기 쓰려고 해"
인식: "아니 일기순" ⚠️
```
- 의미 없는 단어 인식

```
발화: "라고"
인식: "라고" ✅
```
- 문맥이 전혀 없는 단어 하나만 인식

---

## 🔍 원인 분석

### 1. 침묵 감지 0.5초가 여전히 짧음
```
로그: "🚀 [RTZR] 실시간 스트리밍 모드: 침묵 감지 0.5초"
```
- 0.5초는 여전히 짧아서 말이 끝나기 전에 처리
- 발화 전체를 캡처하지 못함

### 2. 사용자가 말하는 중에 끊김
```
[침묵 감지] 말을 멈춤 (RMS: 483.0)
[침묵 감지] 말을 멈춤 (RMS: 360.0)
[침묵 감지] 말을 멈춤 (RMS: 157.0)
```
- 말하는 중간에 여러 번 끊김 감지
- RMS 값이 계속 변동
- 경계값 문제일 수 있음

### 3. WebSocket 매번 새로 연결
```
1번 발화: 🌐 [RTZR] 새 WebSocket 연결 중...
2번 발화: 🌐 [RTZR] 새 WebSocket 연결 중...
3번 발화: 🌐 [RTZR] 새 WebSocket 연결 중...
```
- **재사용이 전혀 안 되고 있음!**
- 매번 새 연결 생성

---

## 🔧 해결 방안

### 1. 침묵 감지 시간 증가
```python
# 현재: 0.5초 (너무 짧음)
audio_processor.max_silence = 0.5

# 제안: 1.5초
audio_processor.max_silence = 1.5
```

### 2. RMS 임계값 조정
- 현재 임계값이 낮아서 배경 소음으로 착각할 수 있음
- 임계값을 높이기

### 3. WebSocket 재사용 문제
- `_get_rtzr_websocket` 메서드에서 재사용 로직이 작동하지 않음
- 연결 상태 확인 코드 확인 필요

---

## 📊 실제 인식 결과

| 발화 | 인식 | 평가 |
|------|------|------|
| "안녕 오늘 일기 작성하려고 해" | "안녕 오늘 일 짓으려고" | ❌ 잘림 |
| "아니 일기 쓰려고 해" | "아니 일기순" | ❌ 잘못됨 |
| "라고" | "라고" | ❌ 문맥 없음 |
| "만요" | "만요" | ❌ 문맥 없음 |
| "오늘 일기 작성" | "오늘 일기 작성" | ✅ 정상 |
| "그하려고" | "그하려고" | ❌ 문맥 없음 |
| "있어요" | "있어요" | ❌ 문맥 없음 |

**확인된 패턴**:
- 짧은 발화: 잘못 인식
- 긴 발화: 잘린 채로 인식
- 발화 끝부분: 거의 인식 안 됨

---

## 💡 제안

1. **침묵 감지 시간을 1.5초로 증가** (발화 완료 대기)
2. **RMS 임계값 조정** (배경 소음 제거)
3. **WebSocket 재사용 문제 해결**

이 세 가지를 수정하면 해결될 것으로 예상됩니다.

