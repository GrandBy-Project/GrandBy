# 테스트 가이드

## 🚀 시작하기 전에

### 1. 환경 설정 확인

```bash
# 1. Docker Compose로 데이터베이스 시작
docker-compose up -d postgres redis

# 2. 데이터베이스 마이그레이션 적용
cd backend
alembic upgrade head

# 3. 백엔드 서버 실행
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. 프론트엔드 실행

```bash
cd frontend
npx expo start
```

---

## 📋 기능별 테스트

### 1. 회원가입 - 생년월일 및 성별 입력

#### 테스트 케이스
1. **정상 가입**
   - 이름: `홍길동`
   - 이메일: `test@example.com`
   - 비밀번호: `password123`
   - 전화번호: `010-1234-5678`
   - 생년월일: `1990-01-01`
   - 성별: `남성`
   - 계정 유형: `보호자`
   - ✅ 예상 결과: 가입 성공

2. **만 14세 미만 차단**
   - 생년월일: `2020-01-01` (현재 기준 14세 미만)
   - ❌ 예상 결과: "만 14세 이상만 가입 가능합니다" 오류

3. **생년월일 자동 포맷팅**
   - 입력: `19900101`
   - ✅ 예상 결과: 자동으로 `1990-01-01`로 변환

4. **미래 날짜 차단**
   - 생년월일: `2030-01-01`
   - ❌ 예상 결과: "생년월일은 과거 날짜여야 합니다" 오류

---

### 2. 프로필 이미지 업로드

#### 테스트 케이스
1. **정상 업로드**
   - 마이페이지 → 프로필 사진 클릭 → 사진 선택 → 이미지 선택
   - ✅ 예상 결과: 512x512로 리사이즈된 정사각형 이미지 표시

2. **5MB 초과 이미지**
   - 6MB 이미지 선택
   - ❌ 예상 결과: "이미지 크기는 5MB 이하여야 합니다" 오류

3. **이미지 삭제**
   - 프로필 사진 클릭 → 사진 삭제
   - ✅ 예상 결과: 기본 이모지(👴 또는 👨‍👩‍👧) 표시

4. **권한 없음**
   - 사진 라이브러리 권한 거부
   - ❌ 예상 결과: "사진 라이브러리 접근 권한이 필요합니다" 메시지

---

### 3. 계정 찾기 - 이메일 찾기

#### 테스트 케이스
1. **정상 찾기**
   - 이름: `홍길동`
   - 전화번호: `010-1234-5678`
   - ✅ 예상 결과: `tes***@example.com` 형식으로 마스킹된 이메일 표시

2. **일치하는 계정 없음**
   - 이름: `존재하지않는사용자`
   - 전화번호: `010-9999-9999`
   - ❌ 예상 결과: "일치하는 계정을 찾을 수 없습니다" 오류

---

### 4. 계정 찾기 - 비밀번호 재설정

#### 테스트 케이스
1. **인증 코드 발송**
   - 이메일: `test@example.com`
   - ✅ 예상 결과: 이메일로 6자리 코드 수신 (5분 유효)

2. **정상 재설정**
   - 인증 코드: `123456` (이메일에서 받은 코드)
   - 새 비밀번호: `newpassword123`
   - 비밀번호 확인: `newpassword123`
   - ✅ 예상 결과: "비밀번호가 성공적으로 변경되었습니다"

3. **잘못된 코드**
   - 인증 코드: `000000`
   - ❌ 예상 결과: "인증 코드가 일치하지 않습니다" 오류

4. **코드 만료**
   - 5분 경과 후 코드 입력
   - ❌ 예상 결과: "인증 코드가 만료되었습니다" 오류

5. **코드 재발송**
   - "코드 재발송" 버튼 클릭
   - ✅ 예상 결과: 새로운 코드 이메일로 수신

---

### 5. 비밀번호 변경

#### 테스트 케이스
1. **정상 변경 (이메일 로그인)**
   - 현재 비밀번호: `password123`
   - 새 비밀번호: `newpassword456`
   - 비밀번호 확인: `newpassword456`
   - ✅ 예상 결과: "비밀번호가 성공적으로 변경되었습니다"

2. **현재 비밀번호 틀림**
   - 현재 비밀번호: `wrongpassword`
   - ❌ 예상 결과: "현재 비밀번호가 일치하지 않습니다" 오류

3. **새 비밀번호 = 현재 비밀번호**
   - 현재 비밀번호: `password123`
   - 새 비밀번호: `password123`
   - ❌ 예상 결과: "현재 비밀번호와 새 비밀번호가 동일합니다" 오류

4. **소셜 로그인 사용자**
   - 카카오 로그인 사용자가 비밀번호 변경 시도
   - ℹ️ 예상 결과: "소셜 로그인 계정은 비밀번호를 변경할 수 없습니다" 안내

---

### 6. 프로필 수정

#### 테스트 케이스
1. **정상 수정**
   - 이름: `김철수`
   - 전화번호: `010-9876-5432`
   - 생년월일: `1985-05-15`
   - 성별: `남성`
   - ✅ 예상 결과: "프로필이 성공적으로 수정되었습니다"

2. **이메일 수정 시도**
   - 이메일 필드는 수정 불가능 (readonly)
   - ℹ️ 예상 결과: 이메일 필드는 비활성화 상태

3. **전화번호 중복**
   - 다른 사용자가 사용 중인 전화번호 입력
   - ❌ 예상 결과: "이미 사용 중인 전화번호입니다" 오류

4. **만 14세 미만 생년월일**
   - 생년월일: `2020-01-01`
   - ❌ 예상 결과: "만 14세 이상만 가입 가능합니다" 오류

---

### 7. 계정 삭제

#### 테스트 케이스
1. **정상 삭제 (이메일 로그인)**
   - "계정 삭제" 클릭
   - 비밀번호 입력: `password123`
   - ✅ 예상 결과: 
     - "계정이 삭제되었습니다. 30일 이내에 다시 로그인하시면 복구할 수 있습니다" 메시지
     - 로그인 화면으로 이동

2. **비밀번호 틀림**
   - 비밀번호 입력: `wrongpassword`
   - ❌ 예상 결과: "비밀번호가 일치하지 않습니다" 오류

3. **소셜 로그인 사용자 삭제**
   - 카카오 로그인 사용자가 계정 삭제
   - ✅ 예상 결과: 비밀번호 확인 없이 즉시 삭제

4. **DB 확인 (개발자용)**
   ```sql
   -- Soft Delete 확인
   SELECT id, email, name, is_active, deleted_at 
   FROM users 
   WHERE id = 'USER_ID';
   
   -- 예상 결과:
   -- is_active = false
   -- deleted_at = (현재 시간)
   -- email = 'deleted_user_XXX@deleted.com'
   -- name = '삭제된 사용자'
   ```

---

## 🔍 API 테스트 (Postman/cURL)

### 1. 프로필 이미지 업로드

```bash
# 로그인하여 access_token 받기
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'

# 프로필 이미지 업로드
curl -X POST http://localhost:8000/api/users/profile-image \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -F "file=@/path/to/image.jpg"
```

### 2. 프로필 수정

```bash
curl -X PUT http://localhost:8000/api/users/profile \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "김철수",
    "phone_number": "010-9876-5432",
    "birth_date": "1985-05-15",
    "gender": "MALE"
  }'
```

### 3. 이메일 찾기

```bash
curl -X POST http://localhost:8000/api/auth/find-email \
  -H "Content-Type: application/json" \
  -d '{
    "name": "홍길동",
    "phone_number": "010-1234-5678"
  }'
```

### 4. 비밀번호 재설정 코드 발송

```bash
curl -X POST http://localhost:8000/api/auth/reset-password-request \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com"
  }'
```

### 5. 비밀번호 재설정

```bash
curl -X POST http://localhost:8000/api/auth/reset-password-verify \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "code": "123456",
    "new_password": "newpassword123"
  }'
```

---

## 🐛 디버깅 팁

### 1. 이미지 업로드 실패
- **문제**: "이미지 업로드에 실패했습니다"
- **확인 사항**:
  - `backend/uploads/profiles/` 디렉토리 존재 및 쓰기 권한
  - 이미지 크기가 5MB 이하인지 확인
  - 지원되는 형식(JPEG, PNG, GIF, WEBP)인지 확인

### 2. 마이그레이션 실패
- **문제**: `UnicodeDecodeError` 또는 연결 오류
- **해결**:
  ```bash
  # 데이터베이스 재시작
  docker-compose restart postgres
  
  # 연결 확인
  docker-compose logs postgres
  ```

### 3. 이메일 발송 실패
- **문제**: 비밀번호 재설정 코드 이메일이 오지 않음
- **확인 사항**:
  - `backend/.env`에 SMTP 설정 확인
  - 스팸 폴더 확인
  - 백엔드 로그 확인: `tail -f backend/logs/app.log`

### 4. 프론트엔드 API 연결 실패
- **문제**: "서버에 연결할 수 없습니다"
- **확인 사항**:
  - `frontend/.env`의 `EXPO_PUBLIC_API_BASE_URL` 확인
  - 백엔드 서버 실행 상태 확인
  - 네트워크 연결 확인 (같은 WiFi 네트워크)

---

## ✅ 테스트 완료 체크리스트

### 백엔드
- [ ] 마이그레이션 성공적으로 적용
- [ ] 프로필 이미지 업로드 API 동작
- [ ] 프로필 이미지 삭제 API 동작
- [ ] 이메일 찾기 API 동작
- [ ] 비밀번호 재설정 코드 발송 API 동작
- [ ] 비밀번호 재설정 검증 API 동작
- [ ] 비밀번호 변경 API 동작
- [ ] 프로필 수정 API 동작
- [ ] 계정 삭제 API 동작 (Soft Delete 확인)

### 프론트엔드
- [ ] 회원가입 시 생년월일, 성별 입력 가능
- [ ] 생년월일 자동 포맷팅 동작
- [ ] 만 14세 미만 가입 차단
- [ ] 프로필 이미지 업로드 동작
- [ ] 프로필 이미지 삭제 동작
- [ ] 계정 찾기 화면 동작
- [ ] 비밀번호 변경 화면 동작
- [ ] 프로필 수정 화면 동작
- [ ] 계정 삭제 동작

### UI/UX
- [ ] 모든 화면이 디자인 가이드에 맞게 표시
- [ ] 로딩 상태 표시
- [ ] 에러 메시지가 명확함
- [ ] 성공 메시지가 명확함
- [ ] 버튼 비활성화 상태 적절함
- [ ] 키보드 이동(returnKeyType) 동작

---

## 📧 문제 보고

테스트 중 발견한 버그는 다음 형식으로 보고해주세요:

```
## 버그 제목
간단한 버그 설명

### 재현 단계
1. 
2. 
3. 

### 예상 동작


### 실제 동작


### 스크린샷 (선택)


### 환경
- OS: 
- 디바이스: 
- 앱 버전: 
```

